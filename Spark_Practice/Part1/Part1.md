# 데이터 엔지니어링

## 정의

- Data pipeline
  - BI, 데이터 분석, ML, 검색 색인 구축 등 다양한 목적으로 사용됨

- ETL
  1) Extract(추출)
    - 다양한 데이터 소스들로부터 input 데이터 추출
  2) Transformation(변환)
    - 추출된 데이터를 정제 및 변환
  3) Load(로드)
    - 변환된 데이터를 다른 데이터 저장소로 적재

## 주요 아키텍처
- case study 이용
웹 사이트 내의 각 URL별, 현재 시점의 누적 조회수를 계산
  - input : URL, 현재시점
  - output : 조회수

1) 가장 익숙한 RDBMS(MySQL)사용
- 유저, url별 방문 횟수 정보를 담는 view_count_table 정의
- 각 id별로 특정 url 방문시 view_count+1을 이용
- GROUP BY 쿼리를 이용해 URL별 view_count 계산
- 이러한 방식을 Incremental(증분) 방식이라고 함
- row가 적을 때는 문제가 없지만, 확장성 면에서는 좋지 않음
- 규모가 커져 초당 몇천번이 있거나, row가 많아지면 DB에서 경고,에러 지속적으로 발생
  > 1) 트래픽 증가 문제
  > - 이벤트를 큐에 넣고, 100개(ex) 이벤트를 한 번에 업데이트
  > - 트래픽이 더 커지면 큐에서 병목이 발생할 수도 있음
  > 2) Row 수 증가 문제
  > - 수직확장: RDBMS 확장 필요(CPU, SSD 업그레이드) -> 한계 존재
  > - 수평확장: 샤딩기법(여러 DB, 테이블을 여러 서비스에 분삭)사용 -> 복잡성이 증가
  > 3) 위 두개로 문제해결이 끝나지 않음
  > - 내결함성(특정 DB 서버가 죽어도 작동하는 기능) 보장 
  > - Human error의 가능성(일정 시간 뒤에 발견하더라도 그 동안의 DB는 이미 오염됨)
- 초기 요구 사항에 비해 고려해야할 것이 많음

2) Lamda architecture
- 특정 도메인과 무관하게 빅데이터 파이프라인에서 널리 쓰이는 아키텍처
- Batch Layer
  - 주기적으로 미리 계산된 view를 생성
  - master dataset 관리
  - RDBMS와 비슷
  - 하루에 2~3번 정도 GROUP BY 연산 미리 수행(부하 감소)
  - 오류가 발생하더라도 기존 Bathch View를 버리고 새로운 Batch View 만들면 됨됨
- Speed Layer
  - Batch Layer가 커버하지 못하는 것을 증분 계산
  - 오류가 발생하더라도 빠른 시간 내에 새로운 View가 생성됨
  - 전체 시스템의 복잡성이 몰려있음
- Serving Layer
  - client가 Batch Layer, Speed Layer에서 만들어진 view를 쿼리 가능하게 하는 역할
- Batch Layer와 Speed Layer를 동시에 운영해야 되는데 복잡함

3) 실시간 데이터 처리 기반
- Lambda 에서 Batch를 제거하는 Kappa architecture
- Batch와 Speed를 통합하는 Delta architecture

## 실시간 데이터 처리
1. 실시간의 기준
- 실시간이란 모호한 개념
- 강의에서는 Soft(수 초 이하), Near(수 분 이하)를 대상으로 함
- 대부분의 시스템은 Hard(수 milli 초 이하)로 운영되지 않음
  - 여러가지 상황 등으로 인해 Hard로 충족시키기 어렵고, 충족시켜야할 이유도 없음

2. 실시간 시스템(스트리밍 시스템)
- 서버에서는 Soft, Near 로 수집되는 데이터를 처리
- 클라이언트는 데이터를 필요로 하는 시점에 처리된 데이터를 가져와 사용

3. 스트리밍 데이터 아키텍처
- 수집 -> 메시지 큐 -> 분석 -> 저장 -> 데이터 접근
- ex) 트위터
  - 수집 : 사용자가 트위터에 글을 쓰면, 트위터 서버는 데이터를 수집
  - 메시지 큐 : 전 세계 사용자로부터 수집한 데이터를 저장(kafka)
    > 수집 단계에서의 트래픽을 관리
  - 분석 : 게시글을 분석(이상한 내용, AI가 쓴 글)(Spark,flink)
  - 저장 : 분석 결과를 클라이언트가 가져가도록, in-memory DB에 저장(Redis)
  - 접근 : 다수의 트위터 클라이언트들을 트위터 서버에 연결
